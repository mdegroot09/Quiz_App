<script>

window.addEventListener('load', runGetQuizzes())

function runGetQuizzes(){
  // Get data from spreadsheet 
  google.script.run
  // if successful, display the data 
  .withSuccessHandler(function(res){
    console.log(res)
    document.quiz = res
    document.active = 0
    showQuestion(res, 0)
  })
  // if error
  .withFailureHandler(function(err){
    console.log("error occured", err);
  })
  .getQuizzes()
}

function showQuestion(quiz, i){

  // update active num
  document.active = i
  
  // quit function if active num is outside range
  if (i < 0 || (!i && i != 0)){
    return (document.active = 0)
  }
  else if (i >= quiz.length){
    return (document.active = (quiz.length - 1))
  }

  var questionObj = quiz[i]
  console.log('showQuestion() questionObj:')
  console.log(questionObj)
  var question = document.getElementById('question')
  var optionA = document.getElementById('optionA')
  var optionB = document.getElementById('optionB')
  var optionC = document.getElementById('optionC')
  var optionD = document.getElementById('optionD')
  
  // get correct option element
  var idCorrect = questionObj.idCorrect
  
  // update text for question and options 
  question.innerText = questionObj.question
  optionA.innerText = 'a) ' + questionObj.optionA
  optionB.innerText = 'b) ' + questionObj.optionB
  optionC.innerText = 'c) ' + questionObj.optionC
  optionD.innerText = 'd) ' + questionObj.optionD
  
  resetQuestionStyling(quiz[i])
}

function resetQuestionStyling(question){
  var optionA = document.getElementById('optionA')
  var optionB = document.getElementById('optionB')
  var optionC = document.getElementById('optionC')
  var optionD = document.getElementById('optionD')
  var idCorrect = question.idCorrect
  var correct = document.getElementById(idCorrect)
  
  // add click functions if no choice has been made
  if (!question.choice){
    // update option onclicks
    optionA.onclick = function(){registerChoice('optionA', idCorrect)}
    optionB.onclick = function(){registerChoice('optionB', idCorrect)}
    optionC.onclick = function(){registerChoice('optionC', idCorrect)}
    optionD.onclick = function(){registerChoice('optionD', idCorrect)}
    
    // update option styling
    optionA.style.color = '#596163'
    optionB.style.color = '#596163'
    optionC.style.color = '#596163'
    optionD.style.color = '#596163'
    
    return 
  }
  
  // if choice has been made, 
  else {
    return registerChoice(question.choice, idCorrect)
  }
}

function registerChoice(id, idCorrect){
  var eChosen = document.getElementById(id)
  var eCorrect = document.getElementById(idCorrect)
  var result = document.getElementById('result')
  
  // show correct styling
  if (id == idCorrect){
    eChosen.style.color = '#00dec0' // teal
    result.style.color = '#00dec0' 
    result.innerText = 'Correct'
  }
  
  // show incorrect styling
  else {
    eChosen.style.color = '#fdb2b2' // red
    eCorrect.style.color = '#00dec0' // teal
    result.style.color = '#fdb2b2'
    result.innerText = 'Incorrect'
  }
  
  var i = document.active
  document.quiz[i].choice = id
  console.log('quiz question updated:')
  console.log(document.quiz[i])
  
  makeGray(id, idCorrect)
  showArrows()
}

function makeGray(id, idCorrect){
  var options = ['optionA', 'optionB', 'optionC', 'optionD']

  // make other options gray and disable all onclicks
  options.forEach(function(a){
    var e = document.getElementById(a)
    if (id != a && idCorrect != a){
      e.style.color = '#dfdfdf'
    }
    e.onclick = ''
  })
}

function showArrows(){
  
}

</script>